<nav class="search-filters-container">
  <section class="filter-header group">
    <header class="result-header">
      <div class="search-string group">
        <h2><strong><%= "#{@find_desc} " unless @find_desc.blank? %></strong>
          <%= @find_loc.blank? ? City.find(1).name : City.find(@find_loc).name %></h2>
        <% if @results.length > 0 %>
          <em class="right"><%= page_entries_info @results %></em>
        <% else %>
          <em class="right">No results</em>
        <% end %>
      </div>

      <!-- <div class="category-browse">
        <h2>Browse Category:</h2>
        <ul class="group">
          <% @recommend_categories.each do |category| %>
            <li><a href="<%#= category_url(category.id) %>" class="med-link"><%#= category.name %></a></li>
          <% end %>
        </ul>
      </div> -->

    </header>

    <div class="group">
      <nav class="breadcrumb-container">
        <% @breadcrumbs.each do |crumb, c_url| %>
          <h3 class="title-link left">
            <% if c_url == "" %>
              <%= crumb %>
            <% else %>
              <a href="<%= c_url %>"><%= crumb %></a> >
            <% end %>
          </h3>
        <% end %>
      </nav>


    </div>
    <div class="finer-filter-container group">
      <% if @finer_filters %>
        <%#= render "widgets/columns", columns: 6, data: Neighborhood.where(area_id: 1), base_url: search_url(category_id: @category.id), param_name: "neighborhood_id" %>
        <%= render  "widgets/columns",
                    columns: 6,
                    data: @finer_filters,
                    # base_url: "/search?",
                    base_url: search_url(@saved_params) + "&",
                    param_name: @finer_filter_name,
                    max_rows: 3 %>
      <% end %>

    </div>

    <div class="filter-hide"><a class="med-link">Hide Filters</a></div>
  </section>

  <form id="form-fine-filters" action="<%= search_url( @saved_params) %>" method="get" data-remote="true">
    <input type="hidden" name="find_desc" value="<%= @find_desc %>">
    <input type="hidden" name="find_loc" value="<%= @find_loc %>">
    <section class="search-filter-container group">
      <section class="column left">
        <h3 class="filter-title red-title">Sort By</h3>

        <ul>
          <li>
            <input type="radio" name="search[sort]" id="search_sort" value="" <%= "checked" if @search_params[:sort].blank? %>>
            <a href="#"><label for="search_sort">Best Match</label></a>
          </li>
          <li>
            <input type="radio" name="search[sort]" id="search_sort" value="rated" <%= "checked" if @search_params[:sort] == "rated" %>>
            <a href="#"><label for="search_sort">Highest Rated</label></a>
          </li>
          <li>
            <input type="radio" name="search[sort]" id="search_sort" value="reviewed" <%= "checked" if @search_params[:sort] == "reviewed" %>>
            <a href="#"><label for="search_sort">Most Reviewed</label></a>
          </li>
        </ul>
        <a class="filter-more" href="#"></a>
      </section>

      <section class="column left">
        <h3 class="filter-title red-title">Neighborhoods</h3>
        <ul id="neighborhood-selections">
          <% @neighborhoods.sort { |a| a[:checked] ? 0 : 1 }.each do |n| %>
            <% if n[:visible] %>
              <li>
                <input type="checkbox" id="n_<%= n[:id] %>" name="search[neighborhood_id][]" value="<%= n[:id] %>" <%= "checked" if n[:checked] %>>
                <label for="n_<%= n[:id] %>"><%= n[:name] %></label>
              </li>
            <% elsif n[:checked] %>
              <li><input type="hidden" name="search[neighborhood_id][]" value="<%= n[:id] %>"></li>
            <% end %>
          <% end %>
        </ul>
        <button class="btn-link" type="button" onclick='showFilterPopup("#neighborhood-popup", "#neighborhood-selections")'>More Neighborhoods</button>
      </section>

      <section class="column left">
        <h3 class="filter-title red-title">Distance</h3>
        <ul>
          <li>
            <input type="radio" name="search[distance]" id="search_distance" value="0" <%= "checked" if @search_params[:distance].nil? || @search_params[:distance] == "0" %>>
            <label for="search_distance">Bird's Eye View</label>
          </li>
          <li>
            <input type="radio" name="search[distance]" id="search_distance" value="5" <%= "checked" if @search_params[:distance] == "5" %>>
            <label for="search_distance">Driving (5 mi.)</label>
          </li>
          <li>
            <input type="radio" name="search[distance]" id="search_distance" value="2" <%= "checked" if @search_params[:distance] == "2" %>>
            <label for="search_distance">Biking (2 mi.)</label>
          </li>
          <li>
            <input type="radio" name="search[distance]" id="search_distance" value="1" <%= "checked" if @search_params[:distance] == "1" %>>
            <label for="search_distance">Walking (1 mi.)</label>
          </li>
          <li>
            <input type="radio" name="search[distance]" id="search_distance" value="0.3" <%= "checked" if @search_params[:distance] == "0.3" %>>
            <label for="search_distance">Within 4 blocks</label>
          </li>
        </ul>
        <a class="filter-more" href="#"></a>
      </section>

      <section class="column left">
        <h3 class="filter-title red-title">Price</h3>

        <ul>
          <% PriceRange.all.each do |p| %>
            <li>
              <% p_choice = @search_params[:price_range] || [] %>
              <input type="checkbox" id="p_<%= p.id %>" name="search[price_range][]" value="<%= p.id %>" <%= "checked" if p_choice.include?(p.id.to_s) %>>
              <label for="p_<%= p.id %>"><%= p.name %></label>
            </li>
          <% end %>
        </ul>

        <a class="filter-more" href="#"></a>
      </section>

      <section class="column left">
        <h3 class="filter-title red-title">Features</h3>
        <ul id="feature-selections">
          <% @features.sort { |a| a[:checked] ? 0 : 1 }.each do |f| %>
            <% if f[:visible] %>
              <li>
                <input type="checkbox" id="f_<%= f[:id] %>" name="search[feature_id][]" value="<%= f[:id] %>" <%= "checked" if f[:checked] %>>
                <label for="f_<%= f[:id] %>"><%= f[:name] %></label>
              </li>
            <% elsif f[:checked] %>
              <li><input type="hidden" name="search[feature_id][]" value="<%= f[:id] %>"></li>
            <% end %>
          <% end %>
        </ul>
        <button class="btn-link" type="button" onclick='showFilterPopup("#feature-popup", "#feature-selections")'>More Features</button>
      </section>










      <% unless @category_id %>
        <section class="column left">
          <h3 class="filter-title red-title">Category</h3>
          <ul id="category-selections">
            <% @categories.sort { |a,b| a[:checked] ? a[:name] <=> b[:name] : 1 }.each do |c| %>
              <% if c[:visible] %>
                <li>
                  <input type="checkbox" id="c_<%= c[:id] %>" name="search[category_id][]" value="<%= c[:id] %>" <%= "checked" if c[:checked] %>>
                  <label for="c_<%= c[:id] %>"><%= c[:name] %></label>
                </li>
              <% elsif c[:checked] %>
                <li><input type="hidden" name="search[category_id][]" value="<%= c[:id] %>"></li>
              <% end %>
            <% end %>
          </ul>
          <!-- <button class="btn-link" type="button" onclick='showFilterPopup("#category-popup", "#category-selections")'>More Categories</button> -->
          <button class="btn-link" type="button" onclick='showFilterPopup("#category-popup", "#category-selections")'>More Categories</button>
        </section>
      <% end %>

    </section>

    <noscript>
      <div class="group">
        <button class="red-btn" type="submit">Search</button>
      </div>
    </noscript>
  </form>
</nav>

<%= render "popups/categories",
          url: review_compliments_url,
          main_category_id: 1,
          method: "post" %>


<%= render "popups/features",
          method: "post" %>

<%= render "popups/neighborhoods",
          method: "post" %>